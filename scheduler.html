<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë°©í•™ í•™ìŠµ ìŠ¤ì¼€ì¤„ëŸ¬ (ì£¼ê°„ ë£¨í‹´) - Web</title>

  <!-- Excel Export (SheetJS) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#f1f5f9; --card:#ffffff; --primary:#1e40af; --secondary:#3b82f6;
      --text:#0f172a; --muted:#64748b; --border:#e2e8f0;
      --sel:#E8F0FF;
    }
    body{
      font-family:'Pretendard', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding:18px;
    }
    .wrap{max-width:1200px;margin:0 auto;}
    .card{
      background:var(--card);
      border:1px solid rgba(226,232,240,.7);
      border-radius:18px;
      box-shadow:0 10px 25px rgba(0,0,0,.05);
      padding:16px;
      margin-bottom:14px;
    }
    h1{margin:0 0 10px;color:var(--primary);font-weight:900;}
    .row{display:grid;grid-template-columns: 180px 220px 120px 1fr 80px 1fr; gap:10px; align-items:end;}
    @media (max-width: 980px){
      .row{grid-template-columns: 1fr 1fr; align-items:stretch;}
    }
    label{display:block;font-weight:900;margin:0 0 6px;}
    select,input{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center;}
    button{
      padding:12px 14px;border-radius:12px;border:none;cursor:pointer;
      font-weight:900;background:var(--primary);color:#fff;
    }
    button:hover{filter:brightness(.96)}
    .btn-ghost{background:transparent;color:var(--primary);border:1px solid rgba(30,64,175,.35);}
    .btn-gray{background:#64748b;}
    .tip{margin-left:auto;color:var(--muted);font-size:13px}
    .hidden{display:none!important;}

    /* Grid */
    .gridWrap{overflow:auto;border-radius:16px;border:1px solid var(--border);}
    table{border-collapse:collapse;width:100%;min-width:980px;background:#fff;}
    thead th{
      position:sticky;top:0;background:#EEF2FF;z-index:2;
      text-align:center;font-weight:900;border-bottom:1px solid var(--border);
      padding:10px 8px;
    }
    tbody th{
      position:sticky;left:0;background:#EEF2FF;z-index:1;
      text-align:center;font-weight:900;border-right:1px solid var(--border);
      padding:10px 8px;
      width:150px;
      min-width:150px;
    }
    td{
      border-left:1px solid var(--border);
      border-bottom:1px solid var(--border);
      vertical-align:top;
      padding:8px 10px;
      height:74px;
      cursor:pointer;
      white-space:pre-wrap;
      font-size:13px;
      line-height:1.3;
    }
    td:hover{background:#f8fafc;}
    td.selected{background:var(--sel);}
    .muted{color:var(--muted);}
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <h1>ğŸ“… ë°©í•™ í•™ìŠµ ìŠ¤ì¼€ì¤„ëŸ¬ (ì£¼ê°„ ë£¨í‹´)</h1>

    <div class="row">
      <div>
        <label>ê³¼ëª©/í™œë™</label>
        <select id="subjectSelect"></select>
      </div>

      <div>
        <label>ë‚´ìš©(ì§§ê²Œ)</label>
        <input id="taskInput" placeholder="ì˜ˆ: ìˆ˜í•™ ê¸°ì¶œ 30ë¬¸í•­" />
      </div>

      <div>
        <label>ë©”ëª¨</label>
        <input id="memoInput" placeholder="ì˜ˆ: 2ë²ˆ ìœ í˜• ì˜¤ë‹µ" />
      </div>

      <div style="grid-column: span 3;">
        <div class="btns" style="margin-top:0;">
          <button type="button" onclick="applyToSelected()">ì„ íƒ ì¹¸ ì ìš©</button>
          <button type="button" class="btn-ghost" onclick="clearSelected()">ì„ íƒ ì¹¸ ë¹„ìš°ê¸°</button>

          <button type="button" class="btn-gray" onclick="saveJSON()">ì €ì¥(JSON)</button>
          <button type="button" class="btn-gray" onclick="triggerLoadJSON()">ë¶ˆëŸ¬ì˜¤ê¸°(JSON)</button>
          <button type="button" class="btn-gray" onclick="exportXLSX()">ì—‘ì…€ ë‚´ë³´ë‚´ê¸°(.xlsx)</button>
          <button type="button" class="btn-ghost" onclick="resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>

          <span class="tip">Tip: í‘œì˜ ì¹¸ í´ë¦­ â†’ ìœ„ ì…ë ¥ ì‘ì„± â†’ â€œì„ íƒ ì¹¸ ì ìš©â€</span>
        </div>
      </div>
    </div>

    <input id="jsonFileInput" class="hidden" type="file" accept=".json,application/json" />
  </div>

  <div class="card">
    <div class="gridWrap">
      <table id="scheduleTable"></table>
    </div>
    <div class="muted" style="margin-top:10px;">
      * ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°ëŠ” ë¡œì»¬ íŒŒì¼ë¡œë§Œ ë™ì‘í•©ë‹ˆë‹¤(ì„œë²„ ì—†ìŒ). ì—‘ì…€ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì¦‰ì‹œ ìƒì„±ë©ë‹ˆë‹¤.
    </div>
  </div>

</div>

<script>
/* =========================
   1) ë°ì´í„°/ìƒìˆ˜ (Tkinterì™€ ë™ì¼)
========================= */
const DAYS = ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"];
const TIME_SLOTS = [
  "07:00~08:00",
  "08:00~08:30",
  "08:30~09:00",
  "09:00~12:00",
  "12:00~13:00",
  "13:00~17:00",
  "17:00~18:00",
  "18:00~21:00",
  "21:00~22:00",
  "22:00~22:30",
  "22:30~23:00",
];
const DEFAULT_SUBJECTS = ["êµ­ì–´", "ìˆ˜í•™", "ì˜ì–´", "ì‚¬íšŒ", "ê³¼í•™", "ë£¨í‹´/ì ê²€", "íœ´ì‹", "í•™ì›/ê³¼ì™¸", "ììœ¨í•™ìŠµ", "ê¸°íƒ€"];

// data: key "time|day" -> {subject, task, memo}
let data = {};
let selected = null; // {r, c} where r=1..TIME_SLOTS, c=1..DAYS

/* =========================
   2) DOM ì°¸ì¡°
========================= */
const subjectSelect = document.getElementById("subjectSelect");
const taskInput = document.getElementById("taskInput");
const memoInput = document.getElementById("memoInput");
const scheduleTable = document.getElementById("scheduleTable");
const jsonFileInput = document.getElementById("jsonFileInput");

/* =========================
   3) ì´ˆê¸° ë Œë”
========================= */
function init(){
  // subjects
  DEFAULT_SUBJECTS.forEach(s=>{
    const opt = document.createElement("option");
    opt.value = s; opt.textContent = s;
    subjectSelect.appendChild(opt);
  });

  buildTable();

  // file load handler
  jsonFileInput.addEventListener("change", async (e)=>{
    const file = e.target.files?.[0];
    if(!file) return;
    const txt = await file.text();
    try{
      const payload = JSON.parse(txt);
      const loaded = payload.data || {};
      data = loaded;
      refreshAllCells();
      alert("ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
    }catch(err){
      console.error(err);
      alert("JSON íŒŒì‹± ì˜¤ë¥˜: íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.");
    }finally{
      jsonFileInput.value = "";
    }
  });
}

function buildTable(){
  // table: thead + tbody
  const thead = document.createElement("thead");
  const trh = document.createElement("tr");
  const th0 = document.createElement("th");
  th0.textContent = "ì‹œê°„/ìš”ì¼";
  trh.appendChild(th0);

  DAYS.forEach(d=>{
    const th = document.createElement("th");
    th.textContent = d;
    trh.appendChild(th);
  });
  thead.appendChild(trh);

  const tbody = document.createElement("tbody");

  TIME_SLOTS.forEach((tslot, i)=>{
    const tr = document.createElement("tr");

    const th = document.createElement("th");
    th.textContent = tslot;
    tr.appendChild(th);

    DAYS.forEach((day, j)=>{
      const td = document.createElement("td");
      td.dataset.r = String(i+1);
      td.dataset.c = String(j+1);
      td.dataset.key = keyFromRC(i+1, j+1);
      td.addEventListener("click", ()=>onCellClick(i+1, j+1));
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  scheduleTable.innerHTML = "";
  scheduleTable.appendChild(thead);
  scheduleTable.appendChild(tbody);

  refreshAllCells();
}

/* =========================
   4) Key/ì…€ ë Œë”
========================= */
function keyFromRC(r, c){
  const tslot = TIME_SLOTS[r-1];
  const day = DAYS[c-1];
  return `${tslot}|${day}`;
}

function onCellClick(r, c){
  // unselect previous
  if(selected){
    const prev = findCell(selected.r, selected.c);
    if(prev) prev.classList.remove("selected");
  }
  selected = {r, c};
  const cell = findCell(r, c);
  if(cell) cell.classList.add("selected");

  const key = keyFromRC(r, c);
  const item = data[key];

  if(item){
    subjectSelect.value = item.subject || DEFAULT_SUBJECTS[0];
    taskInput.value = item.task || "";
    memoInput.value = item.memo || "";
  }else{
    // subjectëŠ” ìœ ì§€(ì›ë³¸ TkinterëŠ” ìœ ì§€/ì´ˆê¸°í™”ê°€ ì• ë§¤í•˜ì§€ë§Œ, ì—¬ê¸°ì„  ìœ ì§€ê°€ í¸í•¨)
    taskInput.value = "";
    memoInput.value = "";
  }
}

function findCell(r, c){
  return scheduleTable.querySelector(`td[data-r="${r}"][data-c="${c}"]`);
}

function renderCell(r, c){
  const cell = findCell(r, c);
  if(!cell) return;

  const key = keyFromRC(r, c);
  const item = data[key];

  if(!item){
    cell.textContent = "";
    return;
  }

  let txt = `[${item.subject || ""}]\n${item.task || ""}`;
  if(item.memo){
    txt += `\n- ${item.memo}`;
  }
  cell.textContent = txt;
}

function refreshAllCells(){
  for(let r=1;r<=TIME_SLOTS.length;r++){
    for(let c=1;c<=DAYS.length;c++){
      renderCell(r,c);
    }
  }
}

/* =========================
   5) ë²„íŠ¼ ì•¡ì…˜
========================= */
function applyToSelected(){
  if(!selected){
    alert("ë¨¼ì € í‘œì˜ ì¹¸ì„ í´ë¦­í•´ì„œ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }
  const {r,c} = selected;
  const key = keyFromRC(r,c);

  const subject = (subjectSelect.value || "").trim();
  const task = (taskInput.value || "").trim();
  const memo = (memoInput.value || "").trim();

  data[key] = {subject, task, memo};
  renderCell(r,c);
}

function clearSelected(){
  if(!selected){
    alert("ë¨¼ì € í‘œì˜ ì¹¸ì„ í´ë¦­í•´ì„œ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }
  const {r,c} = selected;
  const key = keyFromRC(r,c);
  if(data[key]) delete data[key];
  renderCell(r,c);
}

function resetAll(){
  if(confirm("ì „ì²´ ë‚´ìš©ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")){
    data = {};
    refreshAllCells();
  }
}

function saveJSON(){
  const payload = {
    meta: { saved_at: new Date().toISOString(), version: 1 },
    time_slots: TIME_SLOTS,
    days: DAYS,
    data
  };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `scheduler_${new Date().toISOString().slice(0,10)}.json`;
  a.click();

  URL.revokeObjectURL(url);
}

function triggerLoadJSON(){
  jsonFileInput.click();
}

/* =========================
   6) Excel Export (.xlsx) (openpyxl ëŠë‚Œ ìµœëŒ€í•œ)
========================= */
function exportXLSX(){
  const wb = XLSX.utils.book_new();

  // A1: ì‹œê°„/ìš”ì¼, B1~H1: ìš”ì¼
  // A2~A( ... ): ì‹œê°„ìŠ¬ë¡¯
  const aoa = [];

  // header row
  aoa.push(["ì‹œê°„/ìš”ì¼", ...DAYS]);

  // body rows
  TIME_SLOTS.forEach(tslot=>{
    const row = [tslot];
    DAYS.forEach(day=>{
      const key = `${tslot}|${day}`;
      const item = data[key];
      let txt = "";
      if(item){
        txt = `[${item.subject || ""}]\n${item.task || ""}`;
        if(item.memo) txt += `\n- ${item.memo}`;
      }
      row.push(txt);
    });
    aoa.push(row);
  });

  const ws = XLSX.utils.aoa_to_sheet(aoa);

  // column widths (A=16, B~H=22)
  ws["!cols"] = [
    {wch:16},
    ...Array(DAYS.length).fill({wch:22})
  ];

  // row heights (header 24, others 60)
  ws["!rows"] = [{hpt:24}, ...Array(TIME_SLOTS.length).fill({hpt:60})];

  // basic styling (SheetJS communityëŠ” ìŠ¤íƒ€ì¼ ì œí•œì´ ìˆìŒ)
  // í•˜ì§€ë§Œ wrap ì •ë„ëŠ” ìœ íš¨. (ì—‘ì…€ì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë³´ì¥)
  // ì…€ì— \n í¬í•¨ë˜ì–´ ìˆì–´ ì¤„ë°”ê¿ˆ í‘œì‹œë©ë‹ˆë‹¤.

  XLSX.utils.book_append_sheet(wb, ws, "ì£¼ê°„ìŠ¤ì¼€ì¤„");

  const filename = `ì£¼ê°„ìŠ¤ì¼€ì¤„_${new Date().toISOString().slice(0,10)}.xlsx`;
  XLSX.writeFile(wb, filename);
}

/* =========================
   init
========================= */
init();
</script>

</body>
</html>
